# ExternalSecret for payments-api - syncs secrets from Azure Key Vault
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: payments-api-secrets
  labels:
    app.kubernetes.io/name: payments-api
    app.kubernetes.io/component: payments
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: azure-keyvault
  target:
    name: payments-api-secrets
    creationPolicy: Owner
  data:
    # Database secrets
    - secretKey: DB_HOST
      remoteRef:
        key: db-host
    - secretKey: DB_PORT
      remoteRef:
        key: db-port
    - secretKey: DB_NAME
      remoteRef:
        key: db-name-payments
    - secretKey: DB_USER
      remoteRef:
        key: db-admin-login
    - secretKey: DB_PASSWORD
      remoteRef:
        key: db-password
    # Service Bus secrets
    - secretKey: AZURE_SERVICEBUS_CONNECTIONSTRING
      remoteRef:
        key: servicebus-connection-string
    - secretKey: AZURE_SERVICEBUS_NAMESPACE
      remoteRef:
        key: servicebus-namespace
    - secretKey: AZURE_SERVICEBUS_TOPIC_NAME
      remoteRef:
        key: servicebus-payments-topic-name
    # Grafana / OpenTelemetry secrets
    - secretKey: OTEL_EXPORTER_OTLP_ENDPOINT
      remoteRef:
        key: grafana-otel-exporter-endpoint
    - secretKey: OTEL_EXPORTER_OTLP_PROTOCOL
      remoteRef:
        key: grafana-otel-exporter-protocol
    - secretKey: OTEL_EXPORTER_OTLP_HEADERS
      remoteRef:
        key: grafana-otel-auth-header

